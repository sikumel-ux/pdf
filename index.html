<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mahika Trans | Cloud Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- CSS LENGKAP (SESUAI PERMINTAAN) --- */
        :root { 
            --deep-blue: #053a6f; 
            --mahika-yellow: #facc15; 
            --white: #ffffff;
            --light-bg: #f3f4f6;
            --text-slate: #94a3b8;
        }

        * { box-sizing: border-box; }
        
        body { 
            margin: 0; 
            background-color: var(--light-bg); 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            /* Padding bawah dihapus karena nav bawah hilang */
        }

        /* --- Header (DIPERBAIKI: Lebih Ramping & Ke Atas) --- */
        .top-section {
            background: radial-gradient(circle at 50% 0%, #074a8d 0%, #053a6f 100%);
            height: 120px; /* Diubah dari 150px */
            display: flex; 
            justify-content: center; 
            padding-top: 15px; /* Diubah dari 25px */
            position: relative;
            z-index: 1;
        }
        
        .title-brand { 
            font-size: 32px; 
            font-weight: 800; 
            letter-spacing: -2px; 
            margin: 0; 
            color: var(--white); 
            text-align: center;
        }
        
        .brand-mahika { color: var(--mahika-yellow); }
        
        .subtitle { 
            font-size: 9px; 
            color: var(--mahika-yellow); 
            text-align: center; 
            letter-spacing: 2px; 
            font-weight: 600; 
            margin-top: 5px; 
            text-transform: uppercase; 
        }

        /* --- Container --- */
        .main-container { 
            max-width: 400px; 
            margin: -50px auto 40px auto; 
            padding: 0 15px; 
            position: relative;
            z-index: 10;
        }

        /* --- Card Putih --- */
        .search-card { 
            background: var(--white); 
            border-radius: 24px; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.1); 
            padding: 20px; 
        }
        
        .form-group { margin-bottom: 12px; position: relative; }
        
        label { 
            display: block; 
            font-size: 10px; 
            font-weight: 700; 
            color: #94a3b8; 
            text-transform: uppercase; 
            margin: 0 0 5px 4px; 
        }

        .input-wrapper { position: relative; display: flex; align-items: center; }
        .input-wrapper i { position: absolute; left: 15px; color: var(--deep-blue); font-size: 14px; }

        input {
            width: 100%; 
            padding: 12px 12px 12px 45px; /* Padding kiri ditambah */
            border-radius: 12px; 
            border: 1.5px solid #f1f5f9;
            background-color: #f8fafc; 
            font-family: inherit; 
            font-weight: 600; 
            color: var(--deep-blue); 
            font-size: 14px; 
            outline: none;
        }

        /* --- List File (REVISI) --- */
        #file-list { margin-top: 15px; }
        
        .file-row {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #f8fafc;
            border-radius: 12px;
            margin-bottom: 10px;
            border: 1px solid #f1f5f9;
        }
        
        .file-info { flex: 1; overflow: hidden; padding-right: 10px; }
        
        .file-name {
            font-size: 12px;
            font-weight: 700;
            color: var(--deep-blue);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: block;
        }
        
        .file-meta { font-size: 10px; color: var(--text-slate); }
        
        .file-actions { display: flex; gap: 5px; }
        
        .btn-action {
            border: none; background: none; padding: 5px;
            cursor: pointer; font-size: 14px;
        }
        
        .btn-copy { color: var(--deep-blue); }
        .btn-delete { color: #ef4444; }

        /* --- Buttons --- */
        .btn-search {
            width: 100%; 
            padding: 14px; 
            background: var(--deep-blue); 
            color: var(--white); 
            border: none;
            border-radius: 12px; 
            font-weight: 800; 
            font-size: 14px; 
            cursor: pointer; 
            margin-top: 5px;
            box-shadow: 0 8px 20px rgba(5, 58, 111, 0.2);
        }

        /* --- WhatsApp Area --- */
        .action-area { margin-top: 25px; text-align: center; }
        
        .action-label { 
            font-size: 10px; 
            font-weight: 800; 
            color: #94a3b8; 
            text-transform: uppercase; 
            margin-bottom: 10px; 
            letter-spacing: 1px; 
        }

        .btn-whatsapp {
            display: flex; align-items: center; justify-content: center; gap: 12px;
            background: var(--deep-blue); color: var(--mahika-yellow); text-decoration: none;
            padding: 16px; border-radius: 16px; font-weight: 800; font-size: 14px;
            box-shadow: 0 8px 20px rgba(5, 58, 111, 0.2); transition: all 0.3s ease;
            border: 2px solid var(--mahika-yellow);
        }
        
        .btn-whatsapp i { font-size: 20px; }
        
        .btn-whatsapp:hover { transform: translateY(-3px); background: #074a8d; }
        .btn-whatsapp:active { transform: scale(0.95); }

        /* --- Nav Bawah (Dihapus/Disembunyikan) --- */
        .bottom-nav { display: none; }

        /* --- Toast --- */
        .toast {
            position: fixed; bottom: -100px; left: 50%; 
            transform: translateX(-50%); background: #1e293b; color: white;
            padding: 10px 20px; border-radius: 50px; font-size: 12px;
            transition: 0.4s; z-index: 9999;
        }
        
        .toast.show { bottom: 20px; } /* Jarak ke bawah disesuaikan */
    </style>
</head>
<body>

<div class="top-section">
    <div>
        <h1 class="title-brand">MAHIKA<span class="brand-mahika">TRANS</span></h1>
        <p class="subtitle">Cloud Management System</p>
    </div>
</div>

<div class="main-container">
    <div id="app">
        <div class="search-card">
            
            <div id="home-view" class="view">
                <div class="form-group">
                    <label>Cari Dokumen</label>
                    <div class="input-wrapper">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <input type="text" id="searchInput" placeholder="Ketik nama file...">
                    </div>
                </div>
                
                <div id="file-list"></div>
            </div>

            <div id="upload-view" class="view" style="display:none;">
                <div class="form-group">
                    <label>Pilih File PDF</label>
                    <div class="upload-box" onclick="document.getElementById('pdfInput').click()" style="border: 2px dashed #f1f5f9; padding: 20px; text-align: center; border-radius: 12px; cursor: pointer;">
                        <i class="fa-solid fa-file-circle-plus" style="font-size: 25px; color: var(--deep-blue);"></i>
                        <p id="file-label" style="font-size: 11px; font-weight: 700; color: #94a3b8; margin-top: 8px;">Ketuk pilih PDF</p>
                        <input type="file" id="pdfInput" accept="application/pdf" hidden>
                    </div>
                </div>
                <button class="btn-search" id="uploadBtn">UPLOAD KE CLOUD</button>
            </div>

        </div>

        <div class="action-area">
            <p class="action-label">Butuh Bantuan?</p>
            <a href="https://wa.me/628123456789" class="btn-whatsapp">
                <i class="fa-brands fa-whatsapp"></i>
                <span>HUBUNGI ADMIN</span>
            </a>
            <button onclick="toggleUpload()" style="background:none; border:none; color:#94a3b8; font-size:10px; margin-top:10px; cursor:pointer; font-weight:700;">[ Buka Upload ]</button>
        </div>
    </div>
</div>

<div id="toast" class="toast"></div>

<script>
    // Konfigurasi Repo & API
    const GITHUB_REPO = "sikumel-ux/pdf"; 
    const API_URL = "https://script.google.com/macros/s/AKfycbyzNaowGlzUAvsfX0DTnb98BiXM5JkYgK45po94lh2NPj-7rU41QZZ0BV3vBvMFltRFCw/exec";
    const MY_DOMAIN = "https://files.mahikatrans.my.id";

    let allFiles = []; // Cache untuk pencarian

    // Fungsi Darurat Tampilkan Upload (Karena nav hilang)
    function toggleUpload() {
        const hV = document.getElementById('home-view');
        const uV = document.getElementById('upload-view');
        if(hV.style.display === 'none') {
            hV.style.display = 'block';
            uV.style.display = 'none';
        } else {
            hV.style.display = 'none';
            uV.style.display = 'block';
        }
    }

    // 1. Ambil Data File dari GitHub
    async function fetchFiles() {
        const list = document.getElementById('file-list');
        list.innerHTML = `
            <div style="text-align:center; padding:20px;">
                <i class="fa-solid fa-spinner fa-spin fa-2x" style="color:var(--deep-blue)"></i>
                <p style="font-size:12px; margin-top:8px; font-weight:700;">Menyinkronkan...</p>
            </div>`;

        try {
            const res = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/uploads?t=${Date.now()}`);
            const data = await res.json();
            
            if(!Array.isArray(data)) {
                list.innerHTML = '<p style="text-align:center; font-size:12px; color:#94a3b8;">Belum ada dokumen.</p>';
                return;
            }

            // Simpan cache & render
            allFiles = data.filter(f => f.name.toLowerCase().endsWith('.pdf'));
            renderFiles(allFiles);

        } catch (e) {
            list.innerHTML = '<p style="text-align:center; font-size:12px; color:red;">Gagal memuat file.</p>';
        }
    }

    // 2. Render List File ke HTML
    function renderFiles(files) {
        const list = document.getElementById('file-list');
        if(files.length === 0) {
            list.innerHTML = '<p style="text-align:center; font-size:12px; color:#94a3b8; padding:15px;">Tidak ditemukan.</p>';
            return;
        }

        let html = '';
        files.forEach(f => {
            html += `
                <div class="file-row">
                    <div class="file-info">
                        <span class="file-name">${f.name}</span>
                        <span class="file-meta">${(f.size / 1024).toFixed(1)} KB ‚Ä¢ PDF</span>
                    </div>
                    <div class="file-actions">
                        <button onclick="copyLink('${f.name}')" class="btn-action btn-copy" title="Salin Link">
                            <i class="fa-solid fa-link"></i>
                        </button>
                        <button onclick="deleteFile('${f.name}', '${f.sha}')" class="btn-action btn-delete" title="Hapus">
                            <i class="fa-solid fa-trash-can"></i>
                        </button>
                    </div>
                </div>`;
        });
        list.innerHTML = html;
    }

    // 3. Pencarian Otomatis
    document.getElementById('searchInput')?.addEventListener('input', (e) => {
        const keyword = e.target.value.toLowerCase();
        const filtered = allFiles.filter(f => f.name.toLowerCase().includes(keyword));
        renderFiles(filtered);
    });

    // 4. Salin Link dengan Domain Sendiri (Diperbaiki Double Path)
    function copyLink(name) {
        // Gabungkan tanpa double slash
        const url = `${MY_DOMAIN}/uploads/${name}`.replace(/([^:]\/)\/+/g, "$1");
        
        navigator.clipboard.writeText(url).then(() => {
            showToast("üîó Link Berhasil Disalin!");
        }).catch(() => {
            showToast("üîó Gagal Copy, Link: " + url);
        });
    }

    // 5. Upload File (REVISI: Auto Refresh)
    document.addEventListener('DOMContentLoaded', () => {
        const uploadBtn = document.getElementById('uploadBtn');
        const pdfInput = document.getElementById('pdfInput');
        const fileLabel = document.getElementById('file-label');

        if(pdfInput) {
            pdfInput.onchange = () => {
                if(pdfInput.files[0]) fileLabel.innerText = pdfInput.files[0].name;
            };
        }

        if(uploadBtn) {
            uploadBtn.onclick = async () => {
                const file = pdfInput.files[0];
                if(!file) return showToast("‚ö†Ô∏è Pilih file PDF dulu!");
                
                uploadBtn.disabled = true;
                uploadBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> UPLOADING...';

                const reader = new FileReader();
                reader.onload = async () => {
                    try {
                        const response = await fetch(API_URL, {
                            method: "POST",
                            body: JSON.stringify({ 
                                action: "upload", 
                                name: file.name, 
                                content: reader.result.split(',')[1] 
                            })
                        });
                        const res = await response.json();
                        
                        if(res.status === "success") {
                            showToast("‚úÖ Berhasil Upload!");
                            pdfInput.value = "";
                            fileLabel.innerText = "Ketuk pilih PDF";
                            // Karena nav bawah ilang, reload halaman biar refresh list
                            setTimeout(() => location.reload(), 1500);
                        } else {
                            showToast("‚ùå Gagal: " + res.message);
                        }
                    } catch (e) {
                        showToast("‚ùå Gagal koneksi API.");
                    } finally {
                        uploadBtn.disabled = false;
                        uploadBtn.innerHTML = 'UPLOAD KE CLOUD';
                    }
                };
                reader.readAsDataURL(file);
            };
        }
        
        // Load file saat pertama kali buka
        fetchFiles();
    });

    // 6. Hapus File
    async function deleteFile(name, sha) {
        if(!confirm(`Hapus permanen file: ${name}?`)) return;
        
        showToast("Menghapus file...");
        try {
            const response = await fetch(API_URL, {
                method: "POST",
                body: JSON.stringify({ action: "delete", name: name, sha: sha })
            });
            const res = await response.json();
            if(res.status === "success") {
                showToast("üóëÔ∏è File Telah Dihapus!");
                fetchFiles(); // Refresh list
            } else {
                showToast("‚ùå Gagal menghapus.");
            }
        } catch (e) {
            showToast("‚ùå Gangguan koneksi.");
        }
    }

    // 7. Toast Notifikasi
    function showToast(msg) {
        const t = document.getElementById('toast');
        if(!t) return;
        t.innerText = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3000);
    }
</script>

</body>
</html>
